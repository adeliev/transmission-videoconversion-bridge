# Auto Downloader

Автоматизированная система загрузки и обработки видеофайлов на базе Transmission и Docker.

## Описание

Этот проект представляет собой Docker-контейнер с Transmission BitTorrent-клиентом, расширенный набором скриптов для автоматической обработки скачанных файлов:

- Автоматическое перемещение завершенных загрузок
- Конвертация видео в оптимальные форматы
- Очистка и нормализация имен файлов
- Автоматическое тегирование через TMDB API
- Мониторинг папки watch для автоматического добавления торрентов

## Возможности

- **Автоматическая обработка**: Скрипты запускаются автоматически после завершения загрузки
- **Конвертация видео**: Автоматическая конвертация с использованием FFmpeg
- **Умное переименование**: Очистка имен файлов от технических меток
- **TMDB интеграция**: Автоматическое получение метаданных фильмов
- **Watch folder**: Автоматический мониторинг папки для добавления новых торрентов

## Структура проекта

```
auto-downloader/
├── Dockerfile                 # Образ Docker с зависимостями
├── docker-compose.yml         # Конфигурация Docker Compose
├── scripts/                   # Скрипты обработки
│   ├── move.sh               # Перемещение завершенных файлов
│   ├── convert.sh            # Конвертация видео
│   ├── monitor.sh            # Мониторинг watch-папки
│   ├── rename.sh             # Переименование файлов
│   ├── tag.sh                # Тегирование метаданными
│   ├── clean_name.py         # Очистка имен файлов
│   └── tmdb_tagger.py        # Работа с TMDB API
├── init-scripts/             # Скрипты автозапуска
├── config/                   # Конфигурация Transmission (не включена в git)
├── logs/                     # Логи работы (не включена в git)
├── downloads/                # Временная папка загрузок (не включена в git)
└── watch/                    # Папка мониторинга торрентов (не включена в git)
```

## Установка

### Предварительные требования

- Docker
- Docker Compose

### Быстрый старт

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd auto-downloader
```

2. Скопируйте пример конфигурации:
```bash
cp docker-compose.example.yml docker-compose.yml
```

3. Отредактируйте `docker-compose.yml`:
   - Измените `USER` и `PASS` для веб-интерфейса
   - Настройте пути к папкам на вашей системе
   - Укажите правильный часовой пояс

4. Создайте необходимые папки:
```bash
mkdir -p config downloads watch logs init-scripts
```

5. Запустите контейнер:
```bash
docker-compose up -d
```

6. Откройте веб-интерфейс Transmission:
```
http://localhost:9091
```

## Конфигурация

### Переменные окружения

- `PUID` / `PGID` - ID пользователя и группы для правильных прав доступа
- `TZ` - Часовой пояс
- `USER` / `PASS` - Учетные данные для веб-интерфейса
- `TRANSMISSION_SCRIPT_TORRENT_DONE_ENABLED` - Включение скрипта обработки
- `TRANSMISSION_SCRIPT_TORRENT_DONE_FILENAME` - Путь к скрипту обработки

### Монтируемые тома

- `./config` - Конфигурация Transmission
- `./scripts` - Скрипты обработки
- `./logs` - Файлы логов
- `./downloads` - Временная папка загрузок
- `./watch` - Папка автоматического добавления торрентов

## Скрипты

### move.sh
Основной скрипт, вызываемый после завершения загрузки. Определяет тип файла и перемещает его в соответствующую папку.

### convert.sh
Конвертирует видеофайлы в оптимальный формат с использованием FFmpeg.

### monitor.sh
Отслеживает папку watch и автоматически добавляет новые .torrent файлы в Transmission.

### clean_name.py
Python-скрипт для очистки имен файлов от технических меток и форматирования.

### tmdb_tagger.py
Получает метаданные фильмов из TMDB и добавляет теги к файлам.

## Порты

- `9091` - Веб-интерфейс Transmission
- `51414` - BitTorrent (TCP/UDP)

## Логи

Все логи сохраняются в папку `./logs/`:
- Логи перемещения файлов
- Логи конвертации
- Логи мониторинга

## Лицензия

MIT

## Автор

Создано для автоматизации обработки медиа-файлов
